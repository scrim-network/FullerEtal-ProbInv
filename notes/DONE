since last meeting
    3 prior plot with 90% contour (10% contour)
        dot at highest density

    use rejection sampling to post process posterior
        Tierney 1994 is the reference

        we have the log likelihood chain
            can produce the density from this using exp(llik)
                but the density is the same for all samples

        better to use bkde
            fix up y like fixing up llik
                need to record adapt flag in assimctx

            approxfun will do linear interpolation with the return of bkde
                x <- log(rgamma(150,5))
                df <- approxfun(density(x))
                plot(density(x))
                xnew <- c(0.45,1.84,2.3)
                points(xnew,df(xnew),col=2)

                sampled <- data.frame(proposal = runif(100000,0,1))
                sampled$targetDensity <- dbeta(sampled$proposal, 3,6)

                Now, accept proportional to the targetDensity. It's easiest if we calculate the highest density value, and then accept the others in relation to that

                maxDens = max(sampled$targetDensity, na.rm = T)
                sampled$accepted = ifelse(runif(100000,0,1) < sampled$targetDensity / maxDens, TRUE, FALSE)

                Plot the result

                hist(sampled$proposal[sampled$accepted], freq = F, col = "grey", breaks = 100)
                curve(dbeta(x, 3,6),0,1, add =T, col = "red")

    need SLR in 2100 to bin the data.  need to record as part of assimilation.
        obj function might need to return both y value and density?

        use exception handling to catch and reset assimctx$save_y flag

        save normalized sea level in 2100

    1 page summary:  title, 1 sentence summary, 3 key points, authors, nat/sci paragraph, sketch figures
        points
            1. Pfeffer - physical limit - how fast can ice flow - 2 bounds - uncertainty
            2. Paleo record - Tony needs prior - helps inform prior
            3. expert assessment - likelihood funciton - physically motivated priors

run
    more iterations for both assimilation and predictions

write
    paper outline on PI

    paper proposal
        probabilistic inversion

read
    McInnerny & Keller 2008, jump probability, proposal matrix
        this applies to uniform priors on parameters not uniform likelihood on data given model

        wide enough priors should prevent this bias from being a problem?
            the problem is things fall off the cliff near the edges, so probably

        is there a proposal matrix I should be using?
            is there code associated with the paper?

    re-read Kelsey and Schaffer for model initial conditions

    re-read chicken processing for language for proposal

    Bamber

code
    Klaus 90% confidence interval
        try 2 variable contour plot
            red + blue = purple

    survival function

    bounds on inferred prior probability and axis labels

    compare assimilation PDFs
        source('makefig.R')
        assim1 <- as1
        assim2 <- as2
        assimPdfPlot(subcaption="Foo", chartRows=4, chartCols=4, outfiles=F)

        Tcrit is resistant to choice of prior!!!

    Tcrit vs. lambda with paleo
        do mfrow/mfcol nest?

        make plotPair do multi pair layout?
            and label them a, b, c, d, ...

    better titles
        instrumental/paleo vs expert only

    slop in y axis
        use yaxs="i"

    layout needs 100%
        need new layout() that whacks par() back to what it should be
            saves par and resets?

    take Tony's priors

    include Tony's IPCC trends

    clean up old plotting code
        # this code is broken. x[0] is NA
        #polygon(c(epdf$x, epdf$x[0]), c(epdf$y, epdf$y[0]), col="gray", border=NA)

    prob inversion works
        three inversions compared to their priors in a grid

        see randpred.pdf as model
            newfig.R::figUber

    deep uncertainty
        vertical bounds with uniform/beta/normal prior

    smoothing in PDFs
        Tony: ggExtra, Nathan's code

    make run scripts

    inferred prior probability
        Tcrit vs. Lambda -- joint & marginal for 3 different priors in 3 different colors

            http://stackoverflow.com/questions/8545035/scatterplot-with-marginal-histograms-in-ggplot2

            I like the "marginal_plot" function (at the very end - no comments on it yet) and the "ggExtra" package (close to the end). One does histograms, other does the smoothing.

            marginal_plot(x = Sepal.Width, y = Sepal.Length, group = Species, data = iris, bw = "nrd", lm_formula = NULL, xlab = "Sepal width", ylab = "Sepal length", pch = 15, cex = 0.5)

    add paleo and instrumental observations
        stacked

        Prob Density

        Survival function: 1-CDF

        see rand2.pdf/rand3.pdf, and maybe rand4.pdf

    is there a smoothing function for CDF in library(KernSmoothing)?
        no

    PI of y = ax+b
        a [-10, 10]
        b [-10, 10]
        future, x=1, y is uniform w/in 0.5 to 1.5
        x=1, unform prior +- 1?
        joint a & b

    beta prior--is it broken?
        no, squeezing the probabilities into a smaller space increases them (scales them up)
            so rand() effectively scales up the probabilities

    PDF of SLR 2100
        look at pola and old SLR plots
            look for PDFs

    plotting
        both kinds of marginals

    beta prior
        shape parameters?
            following Tony or paper??
                a=2, b=3

    my own prediction function that doesn't create the crazy Kelsey globals

    allow specifying expert as string

    fix Kelsey plot code to properly label Tcrit and lambda in marginal PDFs

    wire in Fortran model

    implement new assimilation with switch

    fix up window code in likelihood function

    merge Kelsey code
        set up git repo for Kelsey and separate rucker et al from my home dir

    rename files so they don't all start with dais
        what do we rename assim.R?

    function to run sample for rows from a matrix
        newfig.R and daisassim.R could benefit

        var.y change

    make model load and specification based on name and rename to rob_dais, kelsey_dais, etc.

    compare graphs

    merge Kelsey

    kelsey says no on this
       -  Vsle = 57*(1-Vais/Volo) #Takes steady state present day volume to correspond to 57m SLE
       +  Vsle = 57*(1-Vais/Vais[1]) #Takes steady state present day volume to correspond to 57m SLE

    merge Tony

    add predictions
       test graphs and compare

    run Fortran model

    update model

    fix gamma prior

    merge master branch

    try adaptive MCMC (see DOECLIM_calib_driver among others)

    update MCMC_plots.R to use new model
        need additional outputs from C model and another wrapper

    Kelsey
        C model and R model do not output the same at 2300
            cd ~/src/dais
            Rscript kelsey_run.R
            set useCmodel <- F
            set useCmodel <- T, alex -> F

    branching with git

    code model in C and benchmark
        test Alexander's new R code
            download robustslr/dais/dais.R

    reproduce Kelsey on MacBook
        no matlab license
